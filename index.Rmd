---
title: "Computational Musicology"
author: "JL"
date: "2024-02-21"
output:
  flexdashboard::flex_dashboard:
    storyboard: true
    

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r , include=FALSE}
library(tidyverse)
```

```{r , include=FALSE}
library(spotifyr)
library(compmus)

```


### Introduction 

This is an R Markdown document. 


### Introducing Plots 

The images are visuals for the top 10 tracks of adele based on plays. I am still deciding what my final corpus will be, but i think these are general visuals to understand your corpus better and identify any big differences/ outliers. The attributes image shows seven track attributes for the playlist, the rating shows the value retrieved by Spotify API. Track_popularity shows the relationship between track attributes and the track popularity: The popularity is calculated by algorithm and is based, in the most part, on the total number of plays the track has had and how recent those plays are (from developer.spotify.com)

```{r, echo=FALSE}
playlist_attributes <- get_playlist_audio_features("", "5Jc1YneHyEETdSuucyX9kU") %>% 
    select(track.name, danceability, energy, speechiness:valence) %>%
  pivot_longer(cols = danceability:valence,
               names_to = "attribute",
               values_to = "rating")
popularity <- get_playlist_audio_features("", "5Jc1YneHyEETdSuucyX9kU") %>%
  select(track.name, track.popularity,
         acousticness, danceability, energy, 
         liveness, speechiness, valence) %>%
  pivot_longer(cols = acousticness:valence,
               names_to = "attribute",
               values_to = "rating")
```

```{r, echo=FALSE}

ggplot(playlist_attributes, aes(x = rating, colour = attribute)) +
  geom_density(show.legend = FALSE) +
  facet_wrap(~attribute, scales = "free_y", nrow = 2)
ggplot(popularity, aes(x = rating, y = track.popularity, colour = attribute)) +
  geom_point(alpha = 0.5, show.legend = FALSE) +
  geom_smooth(method = lm, formula = y~x, show.legend = FALSE) +
  facet_wrap(~attribute, scales = "free_x", nrow = 2) +
  labs(x = "Attribute Value",
       y = "Track Popularity", 
       title = "Track Popularity Based on Attributes")
```

### TEST

```{r, echo=FALSE}
wood <-
  get_tidy_audio_analysis("6IQILcYkN2S2eSu5IHoPEH") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

wood |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```
